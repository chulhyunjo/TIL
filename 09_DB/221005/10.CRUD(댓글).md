# 10.CRUD(댓글)

## 10.1 CREATE

> 개요

- 인증된 회원의 댓글 작성 구현하기
- 작성하기 전 로그인을 먼저 진행한 상태로 진행



```python
# forms.py
class CommentForm(forms.ModelForm):
    
    class Meta:
        model = Comment
        exclude = ('article','user',)
```

```python
# views.py
def comments_create(request, pk):
    ...
    comment.user = request.user	# 추가
    ...
```



## 10.2 READ

```html
<!-- detail.html -->
    {% for comment in comments %}
    <li>
<!-- 여기 추가--><b>{{ comment.user }}</b> - {{ comment.content }}
      <form action="{% url 'articles:comments_delete' article.pk comment.pk %}" method = 'POST'>
      {% csrf_token %}
      <input type="submit" value="DELETE">
      </form>
    </li>
```



## 10.3 DELETE

```python
# views.py
def comments_delete(request, article_pk, comment_pk):
    comment = Comment.objects.get(pk=comment_pk)
    if request.user == comment.user:				# 댓글 작성자와 현재 유가 같으면 삭제
        # article_pk = comment.article.pk
        comment.delete()
    return redirect('articles:detail', article_pk)
```

- 사용자가 같으면 DELETE 버튼 활성화

```html
<!-- detail.html -->
  <ul>
    {% for comment in comments %}
    <li>
      <b>{{ comment.user }}</b> - {{ comment.content }}
      {% if request.user == comment.user %}	<!-- 여기 추가 -->
        <form action="{% url 'articles:comments_delete' article.pk comment.pk %}" method = 'POST'>
        {% csrf_token %}
        <input type="submit" value="DELETE">
        </form>
      {% endif %}
    </li>
    {% empty %}
    <p>댓글이 없어요...</p>
    {% endfor %}
  </ul>
```

