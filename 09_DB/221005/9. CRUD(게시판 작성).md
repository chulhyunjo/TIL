# 9. CRUD

## 9.1 CREATE

- 불필요한 필드(user)가 출력됨

```python
# models.py
class ArticleForm(forms.ModelForm):

    class Meta:
        model = Article
        fields = ('title','content',)
```

```python
# views.py
def create(request):
    if request.method == 'POST':
        form = ArticleForm(request.POST)
        if form.is_valid():
            article = form.save(commit=False)	# 요청하는 유저 얻기
            article.user = request.user
            article.save()
            # 누가 작성한지 정보를 얻어온다.
```



## 9.2 DELETE

> 게시글 삭제 시 작성자 확인

```python
# views.py
@require_POST
def delete(request, pk):
    article = Article.objects.get(pk=pk)	# 현재 게시물 정보 담기
    if request.user.is_authenticated:
        if request.user == article.user:	# 현재 게시물의 작성자와 현재 유저가 같으면
            article.delete()				# 삭제
            return redirect('articles:index')
    return redirect('articles:index')
```



## 9.3 UPDATE

```python
# views.py
@login_required
@require_http_methods(['GET', 'POST'])
def update(request, pk):
    article = Article.objects.get(pk=pk)
    if request.user == article.user:	# 유저가 같으면 
        if request.method == 'POST':
            form = ArticleForm(request.POST, instance=article)
            # form = ArticleForm(data=request.POST, instance=article)
            if form.is_valid():
                form.save()
                return redirect('articles:detail', article.pk)
        else:
            form = ArticleForm(instance=article)
    else:
        return redirect('articles:index')	# 같지 않으면 다시 index로 이동
    context = {
        'form': form,
        'article': article,
    }
    return render(request, 'articles/update.html', context)
```



- 게시글의 작성자가 아니라면, 수정/삭제 버튼 비활성화

```html
<!-- articles/detail.html -->
  {% if request.user == article.user %}
    <a href="{% url 'articles:update' article.pk %}">UPDATE</a>
    <form action="{% url 'articles:delete' article.pk %}" method="POST">
      {% csrf_token %}
      <input type="submit" value="DELETE">
    </form>
  {% endif %}
```



## 9.4 READ

```html
<!-- 각 html에 작성-->
  <p><b>작성자 : {{ article.user }}</b></p>
```

작성자 출력하기