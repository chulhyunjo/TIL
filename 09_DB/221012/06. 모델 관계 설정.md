# 06. 모델 관계 설정

- ManyToManyField 작성 및 Migration 진행

```python
# accounts/models.py

class User(AbstractUser):
    followings = models.ManyToManyField('self', symmetrical=False, related_name='followers')
```

```python
# accounts/urls.py
    path('<int:user_pk/follow/', views.follow, name='follow'),
```

```python
# accounts/views.py
def follow(request, user_pk):
    User = get_user_model()
    person = User.objects.get(pk=user_pk)
    if person != request.user:
        if person.followers.filter(pk=request.user.pk).exists():
            person.followers.remove(request.user.pk)
        else:
            person.followers.add(request.user.pk)
    return redirect('accounts:profile', person.username)
```

```html
<!-- accounts/profile.html -->
  <div>
    <div>
      팔로잉 : {{ person.following.all|length }} / 팔로워 : {{ person.followers.all|length }}
    </div>
    {% if request.user != person %}
      <div>
        <form action="{% url 'accounts:follow' person.pk %}" method="POST">
          {% csrf_token %}
          {% if request.user in person.followers.all %}
            <input type="submit" value="Unfollow">
          {% else %}
            <input type="submit" value="Follow">
          {% endif %}
        </form>
      </div>
    {% endif %}
  </div>
```

